{% if site.google_analytics and site.google_analytics != "G-XXXXXXXXXX" %}
<!-- Google Analytics (GA4) -->
<script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', '{{ site.google_analytics }}');
</script>
{% endif %}

<!-- Theme Toggle -->
<script>
  (function() {
    // Theme toggle - handle both mobile and desktop
    document.querySelectorAll('.theme-toggle').forEach(function(toggle) {
      toggle.addEventListener('click', function() {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
      });
    });

    // Listen for system theme changes
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
      if (!localStorage.getItem('theme')) {
        document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light');
      }
    });

    // Mobile nav toggle
    const navToggle = document.querySelector('.nav-toggle');
    const nav = document.querySelector('.nav');
    if (navToggle && nav) {
      navToggle.addEventListener('click', function() {
        const isOpen = nav.classList.toggle('is-open');
        navToggle.setAttribute('aria-expanded', isOpen);
      });
    }
  })();
</script>

<!-- Bandcamp Lazy Load -->
<script>
  (function() {
    document.querySelectorAll('.bandcamp-player').forEach(function(player) {
      player.addEventListener('click', function() {
        if (player.classList.contains('loading') || player.querySelector('iframe')) return;

        var albumId = player.getAttribute('data-album');
        if (!albumId) return;

        player.classList.add('loading');

        var iframe = document.createElement('iframe');
        iframe.src = 'https://bandcamp.com/EmbeddedPlayer/album=' + albumId + '/size=large/bgcol=ffffff/linkcol=333333/minimal=true/transparent=true/';
        iframe.setAttribute('seamless', '');
        iframe.setAttribute('loading', 'lazy');

        iframe.onload = function() {
          player.querySelector('img').style.display = 'none';
          player.querySelector('.play-button').style.display = 'none';
          player.classList.remove('loading');
        };

        player.appendChild(iframe);
      });
    });
  })();
</script>
